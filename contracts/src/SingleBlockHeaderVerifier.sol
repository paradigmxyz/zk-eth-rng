//
// Copyright 2017 Christian Reitwiessner
// Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
// The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
//
// 2019 OKIMS
//      ported to solidity 0.6
//      fixed linter warnings
//      added requiere error messages
//
//
// SPDX-License-Identifier: GPL-3.0

pragma solidity ^0.8.16;

library Pairing {
    struct G1Point {
        uint256 X;
        uint256 Y;
    }
    // Encoding of field elements is: X[0] * z + X[1]

    struct G2Point {
        uint256[2] X;
        uint256[2] Y;
    }

    /// @return the generator of G1
    function P1() internal pure returns (G1Point memory) {
        return G1Point(1, 2);
    }

    /// @return the generator of G2
    function P2() internal pure returns (G2Point memory) {
        // Original code point
        return G2Point(
            [
                11559732032986387107991004021392285783925812861821192530917403151452391805634,
                10857046999023057135944570762232829481370756359578518086990519993285655852781
            ],
            [
                4082367875863433681332203403145435568316851327593401208105741076214120093531,
                8495653923123431417604973247489272438418190587263600148770280649306958101930
            ]
        );

        /*
        // Changed by Jordi point
        return G2Point(
            [10857046999023057135944570762232829481370756359578518086990519993285655852781,
             11559732032986387107991004021392285783925812861821192530917403151452391805634],
            [8495653923123431417604973247489272438418190587263600148770280649306958101930,
             4082367875863433681332203403145435568316851327593401208105741076214120093531]
        );*/
    }

    /// @return r the negation of p, i.e. p.addition(p.negate()) should be zero.
    function negate(G1Point memory p) internal pure returns (G1Point memory r) {
        // The prime q in the base field F_q for G1
        uint256 q = 21888242871839275222246405745257275088696311157297823662689037894645226208583;
        if (p.X == 0 && p.Y == 0) return G1Point(0, 0);
        return G1Point(p.X, q - (p.Y % q));
    }

    /// @return r the sum of two points of G1
    function addition(G1Point memory p1, G1Point memory p2) internal view returns (G1Point memory r) {
        uint256[4] memory input;
        input[0] = p1.X;
        input[1] = p1.Y;
        input[2] = p2.X;
        input[3] = p2.Y;
        bool success;
        // solium-disable-next-line security/no-inline-assembly
        assembly {
            success := staticcall(sub(gas(), 2000), 6, input, 0xc0, r, 0x60)
            // Use "invalid" to make gas estimation work
            switch success
            case 0 { invalid() }
        }
        require(success, "pairing-add-failed");
    }

    /// @return r the product of a point on G1 and a scalar, i.e.
    /// p == p.scalar_mul(1) and p.addition(p) == p.scalar_mul(2) for all points p.
    function scalar_mul(G1Point memory p, uint256 s) internal view returns (G1Point memory r) {
        uint256[3] memory input;
        input[0] = p.X;
        input[1] = p.Y;
        input[2] = s;
        bool success;
        // solium-disable-next-line security/no-inline-assembly
        assembly {
            success := staticcall(sub(gas(), 2000), 7, input, 0x80, r, 0x60)
            // Use "invalid" to make gas estimation work
            switch success
            case 0 { invalid() }
        }
        require(success, "pairing-mul-failed");
    }

    /// @return the result of computing the pairing check
    /// e(p1[0], p2[0]) *  .... * e(p1[n], p2[n]) == 1
    /// For example pairing([P1(), P1().negate()], [P2(), P2()]) should
    /// return true.
    function pairing(G1Point[] memory p1, G2Point[] memory p2) internal view returns (bool) {
        require(p1.length == p2.length, "pairing-lengths-failed");
        uint256 elements = p1.length;
        uint256 inputSize = elements * 6;
        uint256[] memory input = new uint256[](inputSize);
        for (uint256 i = 0; i < elements; i++) {
            input[i * 6 + 0] = p1[i].X;
            input[i * 6 + 1] = p1[i].Y;
            input[i * 6 + 2] = p2[i].X[0];
            input[i * 6 + 3] = p2[i].X[1];
            input[i * 6 + 4] = p2[i].Y[0];
            input[i * 6 + 5] = p2[i].Y[1];
        }
        uint256[1] memory out;
        bool success;
        // solium-disable-next-line security/no-inline-assembly
        assembly {
            success := staticcall(sub(gas(), 2000), 8, add(input, 0x20), mul(inputSize, 0x20), out, 0x20)
            // Use "invalid" to make gas estimation work
            switch success
            case 0 { invalid() }
        }
        require(success, "pairing-opcode-failed");
        return out[0] != 0;
    }

    /// Convenience method for a pairing check for two pairs.
    function pairingProd2(G1Point memory a1, G2Point memory a2, G1Point memory b1, G2Point memory b2)
        internal
        view
        returns (bool)
    {
        G1Point[] memory p1 = new G1Point[](2);
        G2Point[] memory p2 = new G2Point[](2);
        p1[0] = a1;
        p1[1] = b1;
        p2[0] = a2;
        p2[1] = b2;
        return pairing(p1, p2);
    }

    /// Convenience method for a pairing check for three pairs.
    function pairingProd3(
        G1Point memory a1,
        G2Point memory a2,
        G1Point memory b1,
        G2Point memory b2,
        G1Point memory c1,
        G2Point memory c2
    ) internal view returns (bool) {
        G1Point[] memory p1 = new G1Point[](3);
        G2Point[] memory p2 = new G2Point[](3);
        p1[0] = a1;
        p1[1] = b1;
        p1[2] = c1;
        p2[0] = a2;
        p2[1] = b2;
        p2[2] = c2;
        return pairing(p1, p2);
    }

    /// Convenience method for a pairing check for four pairs.
    function pairingProd4(
        G1Point memory a1,
        G2Point memory a2,
        G1Point memory b1,
        G2Point memory b2,
        G1Point memory c1,
        G2Point memory c2,
        G1Point memory d1,
        G2Point memory d2
    ) internal view returns (bool) {
        G1Point[] memory p1 = new G1Point[](4);
        G2Point[] memory p2 = new G2Point[](4);
        p1[0] = a1;
        p1[1] = b1;
        p1[2] = c1;
        p1[3] = d1;
        p2[0] = a2;
        p2[1] = b2;
        p2[2] = c2;
        p2[3] = d2;
        return pairing(p1, p2);
    }
}

contract SingleBlockHeaderVerifier {
    using Pairing for *;

    struct VerifyingKey {
        Pairing.G1Point alfa1;
        Pairing.G2Point beta2;
        Pairing.G2Point gamma2;
        Pairing.G2Point delta2;
        Pairing.G1Point[] IC;
    }

    struct Proof {
        Pairing.G1Point A;
        Pairing.G2Point B;
        Pairing.G1Point C;
    }

    function verifyingKey() internal pure returns (VerifyingKey memory vk) {
        vk.alfa1 = Pairing.G1Point(
            20491192805390485299153009773594534940189261866228447918068658471970481763042,
            9383485363053290200918347156157836566562967994039712273449902621266178545958
        );

        vk.beta2 = Pairing.G2Point(
            [
                4252822878758300859123897981450591353533073413197771768651442665752259397132,
                6375614351688725206403948262868962793625744043794305715222011528459656738731
            ],
            [
                21847035105528745403288232691147584728191162732299865338377159692350059136679,
                10505242626370262277552901082094356697409835680220590971873171140371331206856
            ]
        );
        vk.gamma2 = Pairing.G2Point(
            [
                11559732032986387107991004021392285783925812861821192530917403151452391805634,
                10857046999023057135944570762232829481370756359578518086990519993285655852781
            ],
            [
                4082367875863433681332203403145435568316851327593401208105741076214120093531,
                8495653923123431417604973247489272438418190587263600148770280649306958101930
            ]
        );
        vk.delta2 = Pairing.G2Point(
            [
                21123566812647512440160169877836656797717899770123336419072992569379057132059,
                10532969933160472488544725974676172937245268580301381319710739250793312360839
            ],
            [
                8242794290348542147937827669485542761081323263202970706081698386722149313519,
                17601228624893609784876110801518270352158340825875187409342319796970738450374
            ]
        );

        uint256 icLen = 199;
        // MAGIC_NUMS len = icLen * 2
        uint256[398] memory MAGIC_NUMS = [
            9647697230332852281578537999019130496158462207747871141463033915054639187580,
            1240101035271153627983036123748231231078745523530381870056836081402233061189,
            100867112488681346203486556028299178334910628852962632858021904326888330578,
            16864467867725725842580194734665827799672651112845236983173340057523163589791,
            10447961146376487149745107834135977173129505263649323525182633891817984617566,
            9298560807224883919993717247643037464417758115759316034474626634473592909638,
            16259855830821244982689284233808009141600215949346527260373374093803767086345,
            18949475711524002296021343786755692478959222269069828627809844386734829356620,
            1457394225920159175211656673197335745317224330524241338719927348074099870019,
            17869952579633093033888943007931711565082427981970766912085922967583274053487,
            10895491154951131669760779963752085093025336299339283310035380299888587995417,
            8819398611672705991027217184388901874592312010658131403964714658159870453056,
            932241432078435291009399964297852109641425246244078551384883703878002021593,
            8058769488280040099273519719993747256196746815368813111115378825096713041431,
            12951761378700029909876978865419194423027174973519794064584151538243485094576,
            5678546531771810595546953432611757037656935018264793335034427140311675370571,
            5792059461762115876479839643432890450908356355526539690451483107751722316429,
            18893161375089622379908279100562331292347879079958975262264204820226813758225,
            15248808532147870135535015858090063873314901245921686460739430482894862382657,
            9177831858531834212211534711094647333797248313906562256502345453397822308910,
            17129040803044470533488227296583434163239247331130000382421458815021206723852,
            15813959361120158448651080209163774686046268101428949933222579925252617134603,
            9533268625997731416041194526533045849999400955321618333108068356604849100216,
            6092458356862895306264215015767032652507217677242451189515439950526562699597,
            7627337520798138195947558463197427263436827255847857881879425428036178306769,
            7104494062464494467431768455674883274215521725300310583245301182778290604580,
            10661888764862220123480244407381060241388809438442516593973416482007281694338,
            5797333454252796560343829258423303949355091195792541626502844081260010272589,
            12721489874952149948784585240961424368473465918766805877782114134297709675219,
            766828630566780187886016236971388996360226371328613329132542734810352745889,
            7972808459718369407084437868749151613844034081942836916599958463046123880087,
            1553268828825525353184834857350512375160595656179995360400887986926687982874,
            7506505270107845644293314520842211173965175610203425396050602365077643860491,
            4340815576619388372180099853721834767992567909980161864424620531493528476355,
            5327954937895103427040202544330037321896435997238153172895093505414687826891,
            19388170050521145148507849692456440540076777213899022062940583595749485561932,
            697626646564689876426830866185919393680815409110792372106613143038621379065,
            11561076258608028571638023253488543144687901098276599993987852842213821828045,
            9736368179414764608699781981968366448752294393909670258214206216936230510523,
            21138439549120128474926558559982294219211428346302796032273773102635225621712,
            13560759923084882290314052081098902486349978378099377768267023231485839032002,
            11766146879066062947560325550259371963609537003166310611904100403835525004627,
            20975953345356828313280617349674992604629397722760645454601675103065664113968,
            18034046582630009666041890890431070511013770951912651342812781068537610055048,
            4211788994159400440268622549593481639773211363610217461844897298631983899535,
            8668337747153860533568655253294005135395258286411527163329857974355534089781,
            11012357464295202182259905350238292249380194389380755863880314642499287035283,
            1833365604600464041473472660947957000586938929183653597624040863639985740626,
            1282805328633175844399736111781827627937863022780261071760460446367156503201,
            7488321506263055640566052087359190352913084738771413322862579305499022572268,
            11443398515551261260526079284110760270925720693924033322576773173353073810588,
            1332725831782085340796657008014442711902904535308848772590409718866901882927,
            14558260786592269402985752696474799603912285598191704365898305896639302314299,
            18037955701806622162946672629654304964665258028764080814522643533491046959717,
            9322374269640708329944463685899724905541526546547628769362753120902950937300,
            18296556099233820496545346490117541684689559409950180941612604192828927106398,
            17593214787803314258171792843664032477823655055187999582447745850449661913796,
            9289378155513691102312029405359412568884325399298304448000996551000676872989,
            13626603214412326962395884453324602734590479350803075505108486988216710473412,
            11516782969580735520132237877614904069418657550544044710398731814417526296843,
            9967902928673077760408719533841723081457979706852593629288720996571669025230,
            13037880138861612290935141665868516752468395135703433402493263221787838310740,
            9690866170657648366341048672687016893353452677757135990100245498360719675010,
            8448097229988193783616918430605596214819691025796067310480327541752913264533,
            17310675941155765095296981394562978950820239139451162860250783412418861597214,
            18024865657578864935736616345288047031168795232680639535535873930283764019362,
            12775301847177688611352371159989373063742518397241862492474306928736674257623,
            2786934077081491894253124971712693793923911806923296295887976622952753968994,
            2989916277086962475735384339754292007333256332001479455812048694689393212248,
            8146497505876049630235123914615706811765684973337503580501277714769193484954,
            9604647390879864386484280604951535749556875098473229499488836784796300297586,
            14968748683435906928598936623024104611485621551063890753505319968550188087781,
            7534592638666214718431551391114654371640421929988383640467354385475516428181,
            11062749237125091573021110758914610088959913235778589576233047080855778551233,
            8314062317450678755152074182235891609466864192977728311502787988316087023189,
            964197692926038134081598005977646519991727384811693167632315854978842369620,
            17838708245086828676567551698600806638356249041927355894846146895450751835893,
            2136236755607982521807587195849291870468873558001548738290382215282932833622,
            15335234748296304479493478113501037914327673175075237408168597399672607161737,
            16309109173811847065227995811257499161477535351119066226262351751616603157395,
            1963853913492719604574939429551681371285343334605616561219237506845979507476,
            7633880082240817403849029792809861411604880811530150869062128863111254583440,
            15597184884088278229785890934136326733679757002293110055758995671453985839118,
            8948918750601751801740153842614178302108829281616006204156009376124962427751,
            5801512662502437982695653204380548093742870539676898158306694904866128668148,
            6627423415385146993582478501294238528196570328743411000594138572850804505749,
            14565873002004106260877813291516876429001270584379155935862248298774473088229,
            5092207004447910188467523416928198848782418623659245111578604728521794232546,
            13097086857933810247012704640050269860594276174189055876636274185432190177817,
            12383956886362079742443294021796254498064128619241926639629736757504572291338,
            13707468580414105996976894407124550404636322873006269695087047169654559878081,
            3348191534664570106150114495333197193016933798942731736458789464694892535441,
            14990505151434537937992503519447962938280632553988937112052978834915745196074,
            16990577489604686650494594605376100546778276066883509300491860088094798603201,
            15588610974892186464664350674202051604163475124448012220647991349650574407170,
            5851815793256280878602373540311377209666981915548492022638633211554377024958,
            16048695170745796391677590068842679912868660485672067105186450994106830182364,
            10265984757142654828327756970234391678403023186462698200235492122962475097717,
            3159290373758835272645880007067637223227062151918386898557697761733541102116,
            19900524797512612733411241544025217180139918388185528285081737688086432617426,
            4680107961545524189800203224915557129305057333063392581995778847131151318053,
            5890019155566040895399874281261400774700866905996222158235897173293366284040,
            15016747969889886237494959138332432575934147473477077101856331749555006260055,
            12743926245967635085830082201537464369037391422924333631365140149953346241582,
            21065894779512638339684287720352686430782666480527098011324104739909922420944,
            18670944565865079816627870639913596701810269721756363081689579313913725199891,
            7474476261051495309391161197244458162027858838837201291658924671160184907991,
            15163333636669862030702513529981614941195359499949941878443412104031154725828,
            10703381004724546030099881559468183557445528250190403545807643004611667235215,
            2449677436637263386085888058082160301684303362531087097566343527213623283610,
            18669326301765063129232927964962115449158667353197438252131250875336786713898,
            21386173963025891303333512236605652006087210107917894872004978354241793005720,
            14452236251902154648134687647709915754225864144429232263234630780364365933706,
            4624539685191714494229478701203448041112038114080973500871330958873801289690,
            17646897685506882396200163360881932287542695690061185071516995975936094166052,
            1567986090912921598246100688873579030047581433295124675850469184350284735063,
            2719019503516318731351766447128130332458614214648566403944806719156921585010,
            4489711086523741402039998222886025446587137067799216489915253701835166267254,
            2940016242275124845129161719232089103950272059585093422168548326996534824966,
            11949872403584437587899237356899837646009202317672079016751029687160985857085,
            19485442797164045555593569131972355871852492787900627833745259064629127078808,
            18531640455189077231866711249397266082888498307599792573115556903952734482986,
            3116770843674311367273477130752787143919090148790107922430835922547226737856,
            21129415318410018329053409913520081365690594463561904185232279310672220517370,
            174328891500618053457355715216504235739689073605113645841597294410485834596,
            15140584112463392431288952736455156952326232535085658654060595317290046365444,
            46442612786124071021277862306427779080072508683155765543542145923817393059,
            1230627132074224179996297795215867856446129247432742527683916629344437396483,
            8655547055564236749440657539529194340855191639625134196506930948039122153083,
            18674930446257096690142085939817253531261785671121103922586707408553876316117,
            18625481266165313119534899846682681729349692823236814580723519094255958397358,
            9688308283967335575708560088644929451160813495402432338124881269738251107331,
            21147260901557602744679011054050603401535487661955023951078553473627419136772,
            17416597605869215792836807473687577380535367857694270967588987728052820298374,
            15208216534487464444048215032263341311076102731550390007299626981236330988031,
            6940427007864085227437528709037460323478901831350459880443932846951466454956,
            629828069452404753026377389394239610965428126990794202120066661791995994580,
            14682449202651275993550256785437354760692785987907895229457015457748286630277,
            7037528508194442843427873825570201845877925569835458803718475723317634713078,
            12124159496874350768078679588197558742820832891192838248526543130911770620578,
            19001731598953875734223341270298248499347202905928972932066496510774437114312,
            20668283438064107666490788856367716206209650406140401755201475680588215206156,
            4689570785733068637582593168492561098957001736551155600874506803334247892449,
            19659017835796927456931437442846940498622251791093782172466870829632015420593,
            17650070072398479562730264051191467134798560420435292589018788428115591263219,
            18191877496132505442500397626338920315366266594145089873481217026045106900812,
            20493015381034379921290688390879435357528643449120951595523669808919710485612,
            19277841569613190385329555318126204906266592365565588794483164976127853005367,
            8381575755571493442479568534278548218303591509031176966375244284263653876542,
            466415565613001485772266043316541777232138693187881129036469508678296853167,
            21249267917258317839796282816692499963083224482469481268376097742460026721752,
            3860588545378021113909276116604359049651880222577686172244805175516399343353,
            10485791451201585515246490935390095716538030689657638149738113993954408253219,
            3443749174724745333041752073012166946561622981050832335603585088065962894779,
            18963150202897371619557598228795694797053019386855321397628946261007041988631,
            9354295595544415975305182269844278956886258937497111648649151827199762894001,
            17866903059274092530845213751909024983346555610734794862756003842967379933815,
            7679691074582560026186024523324510974576169285394300442998452125901668170396,
            21620180634984353706504478167615057298409100187373945959445309560632538992106,
            13443905689049246098324026789116457963394899070545928528734802807009906561653,
            15889194544721057704404522864164386839656905750752907639706107167765555678455,
            6285360573549876047031854340373177593096163970981522327076655086076429358267,
            15712626507985365660912005322189176096910327832855402086458552291503608621658,
            1697560900795380162251380587684422809926245102673871770938215879350785666622,
            10530077981101258050921589149435224119352282785317350841518882503912165700159,
            11643455375594598328003125632598709240689124708510727632207886642372267260389,
            6146226492657708655550180450127838938356968070294965432985811773911698921108,
            18401762241208683121880322400735206093214470919132565447978206584604100946350,
            5597131473478673627066598372066829095292304285816601879478885291203039941317,
            4373524434330388100271240185887955821080970994214065133993253357722938921361,
            7493594814321286551583730601535046770903282284291437626810891891601596091522,
            59144104630973562798918591182925869703160478061933587422412753406935970271,
            9656915547024185687817747759029978478017257944577671903860857829889143652941,
            10275223798187148052622696877210922426614373181132665059526868335197839739602,
            7033055089752695029960289827844223352893310434144386284211856673258642444771,
            2850402731965849300093986650903044248921488569503943831184028390732691535039,
            6255007820655502543810301467837173499836737455263221635228889509484719566462,
            4481756017361480498246563043625263583779543079010914082974972842416116969069,
            14901518360577951745789209508553737730745862721117523716359005112300812710704,
            8839103217050461030618633550264679370023609330773647676508401297700441275165,
            9758976040496035164767563941083566094306891742981325018163704273025340809224,
            11974373978445950413515399131787238810820319269932699990610175695727949778205,
            9138917181736563472186275185568755127192689859345337731384492621786189281357,
            14797841391855286897725592177764516353343425879479073348261565004762101443703,
            13035658311784518005179329187319029383045306937512782521937860557266135727765,
            9763101140823219096497640731026399058716819784908147512185632800570243697019,
            7367296352557042059678221457697961118112193475610668011359272120925617907324,
            10709279904399677875502842047678979042275548836637957447070247989430164687389,
            13729915325581351806055413204368252973866399292079019531824236919562613912938,
            15602118095117092567084555690271548291923137201400502607985049868908788984838,
            20631854538709468431362528675823859963321372150830133917087495336019721605405,
            6179834405204477184550005535382224131803293148160092242647533424550128692321,
            13325305599933461843127821438980900064146309093125469274431320247314788891448,
            18249045160499254301323391169438983793314544378648977242468096345890061641677,
            2806379095150051749584622154409929194351858614653018833122213622747671066634,
            18814787951643034828412262145098885965584047598731223260430478391058291283417,
            12994348611913909391439486152178102696126984655772131818170447954868963953621,
            2024078449007993634751194457029052197812049894969583772342528624277315603925,
            16981224741895580227421503566395617745678943159516038129177465081419919131271,
            11920525329765202833350905021702031146655790354387135262589025600843818492456,
            14608304812403147812274627928185447189126240534350899191485381388965008148435,
            8192165483775817784627741518836981706549620304410401031810632806361130053175,
            12184388843711961435534597417194203492620256005558726989391470136156224628284,
            7559905057763158231916805645176028638203254226170766484309298856553041946117,
            7329861243361729645997418312763561632453699750032569142400356640524513443163,
            5747881129499183221527473676446778343092874463878122241721230711656253735915,
            2111177087708212341241461503590014817346388620142007527488051217618480679793,
            21570318853671322018851343835786216910513868843764756613366169798462154088828,
            2592404371119163764840855562837757328444658083923588473846625988955110750311,
            7401750109324840557948364825968918526950023321715938564993561373145117263813,
            16453481340281275080652424952566191401296013755831261982950596732093203360977,
            7345810385629424042906641655152905095877023226081554887611171655330572579942,
            5748754579627394924584503746931993457156398071412764805819628531548507460285,
            7519918346073375223717536906790506739480473273604851853903419006221771881130,
            9446671196393631081132495134408310699532355855439682412387506554785204530383,
            8489185423759969403376719052851937197788298614175310253546192048753564649721,
            4654243280534470424975987003211952638234910076551351763710325726255955170691,
            13167934611484315545378074387762177160164116414775839306275557772313714404698,
            20109822375050299206346319760565609082789024798947703951712340418158427135033,
            21839287049671438637039601956026316177234000664452691159036464660746949770429,
            14201151025696589730959380497454851849050346831268298238032812313198731380222,
            1023088050350059378523629945811865562453437687716924890915311064028449080690,
            14605568710506856375090269233197554647058737889776936970628376386771156267368,
            983207231976161069473146308298141057237209080399188466675347088199658997601,
            8103057346701828500450393196158392899668377611467287173546992648983662859609,
            1131721906846647067746523269275613420757015378450351175012262540013798401292,
            4049850515400267979951931716847131680244983691551190402076607242893631756423,
            1221556534306522314087735427488461866584535725313745184130387291252181330935,
            1228061852473408084870915398925824352350672210553208420005949355930780707182,
            990388390109076402393665787587495419513450375454680285363851135518100867645,
            13628559987819182547838569669925009101232106889827335850565162049735346721095,
            21423407004668271488465389423463444339047626123705314388865742614793387217687,
            5769022097302022669168526217044443649676627748578199492178759979928925061702,
            9646522436926266708856953951616498785465937847038248846807218756925975718720,
            11066000110062630198132289073909343276684527011577860024294863310959647086966,
            256679987860059912446229282731066830514706605162328451656971012582993478711,
            8088302418397128406883163530896096729989517625538675026041978136113904305464,
            5032245329134674748975041339667121322217437709053561176461748642643613619005,
            15135569013792182670074572020158265025945934957112276042354294382922544871850,
            4120139320829961321243907119574315259492046628904352230233670366148769255087,
            842779130597831793782101360529764457614896034266033253328192833888265267415,
            14507443534182178733499401944199667191751341014553962052912677532164653207814,
            11579628665913805335943287217243120518102890329415895379535318544425173741404,
            18674445604826003584366066065834913692980758237183130060620760000090378901096,
            11165385294339432465015596538315094180360586876556401853292660921146844472964,
            5020116086157924635499337160617887741152412056886676460776073265631924368657,
            3102277517393736272152423176904569968805479184839910958947356142300281061175,
            5161557299150789504073660337781166278002609707173368860668897990466014127208,
            10910948596406246312005297070353311439938937925740031857261650501364191985039,
            6364123513704995581869443171451542985086565501656128582179676201922960257932,
            928631273574720473962320673481287842164371357001436542546898790095743623942,
            4750311747052187140923405090989789190110218070828280770954336788995783222623,
            4107356860709924466507161759422220082170153234085382943213058769985960872421,
            18918686826259950000068295778410035429461196544813378927856603697678111850934,
            20835113126211588151717795145209963952945972442346410615366574649427058267667,
            9460571291699410793114451153161997491265453492846991928902059796277719505470,
            12616613962751590292446316420104851465590405816616265453972554236131637567823,
            9909835123617825052203063398457734322365948885713847643720085297082111542804,
            9462454898263356254498349673974645742120351672989976595882784286883530298919,
            10258576212035897306176450018950436565639158609726826776868772352525664239387,
            14517675051331578586320501571924381207670416567741234078620756880491158199870,
            21088872395820811840049942258301478233166458508861629538721974892399609446335,
            6233282123637948279280890274190118267966643230358091120750952910539176409798,
            9796254774541835900837000536649670578992212917841080810579639687772622651424,
            19844995905818827785387794162717807453391877342749205673895666989169361987230,
            11398489545351734028384099705802585236168461201719718834156511636157576784783,
            13763437074782927611213810968159767089831249046545532159988960004258384495427,
            6746125570451686893678764116819896068252834985187551365462172559751960124148,
            19962988728355900146217440413263251752956138793661882742016211631326590460532,
            11647700968509292253297895549493092048916603033363070243299545766424467550511,
            15069799741640675048680378630375921538551431939946466450146330584387242097809,
            11655734900260152348307022124786611979589580779350615161749715039788114925720,
            663371025175434572676046704898203157201039214610021500593192211253501092473,
            2826064757395700619291533653420739441695269134310905107523939855064365917071,
            17535058903451964743624939087879013690717304818278226437235042536347498072509,
            12213260454848025618653061615421724465871343931259031674170323427354820015585,
            5572071388871173762883774752211416001277373208596879381836741808693585536181,
            12018521925150622734374077865093875212203309603884706265679041949538539036545,
            1485494520402311177710117970168273628090314890204400997052319115833255292477,
            10251478399690402084224518994634748710603893271894349108465557246767301123112,
            6256161973189660429487351314728732062553265788771749996820172006927728978242,
            20121826702671572480325561580801148385068656841015998031714211680402094695883,
            10789773919392917798724469596479753255902800482096221432109745626539992843789,
            21085803643910866301841161917653364102251807542242616631899652578097414187023,
            18337729963184133982001792333704449205378034198756896509825264602632014148872,
            18860331945271290710240218351439341973931118824788996432107448137044498077664,
            12445216633008396088354429172338233347396425446274325767596120128093489040304,
            8176115743893852038987979709939976811391599804738798357321541655670264414200,
            147279449279930871081184024223024643212363083624270185467886877903417333395,
            6764818209897285645429872338525902544797831687740434337853453365155291635226,
            13178679841289987200833070618735423247321088902873207401369476291377568009326,
            1450913087829338849097428272794333120431457088685188354398394785401232652426,
            1536455295761138039066398707215928517270019947255206109672234612956920446814,
            12986963065499820781192889241900577730689841329948538775378896154025149530123,
            17976521617732775668761475161019407330147409139821646626622204632752846371100,
            13650353920998451338944957875807791116502239608649007021156463289343144253450,
            4823994914999357924799184687213972893044493142241518302343322217393740882861,
            2694115769624691976446183606114056120326174169794106356214607906524505174584,
            13045205144014578455760950809877597596050681116647913206581050072714779095312,
            18612943404858146960166274759469469618450106520625863983643023361359766641493,
            7575687673054094522178846414616831298627305023466195085290350496976731356229,
            4549903743725593477188240970785650411127720291907050595277227923208426667620,
            21832480011694666837738612933598564685405140353170809385062038036069334278328,
            5570319662185762101578295601587002236708575355525141531221859624203267183896,
            3443290038589242978347579528782379585612429061018541219752730532671956923301,
            13362843931497362480837146690662443765237481244071618216990250369558175946824,
            4444869275031454521446006283030538615568973592602780507868029156868579079013,
            6534130128024011232261034803407792036331176763726140691062046316200661881577,
            1665408457570462791542712734060001833648827727857905614277923684175253036865,
            14030137657917478559183439251823292901675682179138516623013511907140565506583,
            15525841837430970244642452512067640186225036177077717518254485474873384471944,
            11356132092484864379132511173414782906395425712592149317890032573683509856138,
            9301435821174859830420904416177063079977249844966104323648421874459594025926,
            13329020852385277986420016864018019486572658487186224787829738432241177839811,
            1570973604512330265000547610865527170685831354298345645880825037128256267449,
            10437265774713057263669258029304181286873019570959809482550521171128663932467,
            11776901106882713538348927131090056083247442390030476323040633720471092969526,
            6479611471814499283621750618833649426584479402942208426714875591536098454174,
            4302355291586195101021958507702519546090591622190962357335808761347908405835,
            7780359643188900540109284828806051107449110480373623576919621000156979835075,
            12321643726313476717240338058845063789625893793193082250622653042357057286466,
            10103962106977768750788219399649446834033585092932543340729186783661787680334,
            1155770776570738402673711788115331212527211475860205707746257755381041535889,
            21427727422277293792497718735198728325006584109865523502097197389135856551831,
            3864026136063435002343430041242088935164418166684658196548890481238519825665,
            5125243468851809773919020264464623795792231344986712387236746517731062885166,
            906859424573243619826253993137954779998521273554167495342549040696301350723,
            17128698346499909161476453955644809250340018916493186920156511112981085507858,
            15052266102979392224175509032327525254881072932401711366687438818415277272316,
            14883490524227939979341968381893969464236145866941230163931622131042427413720,
            8791936442580427291751714874965975961538733778580720167907614903295962392413,
            20968990693228270291530391057730133898707084552987978838958990340435087196240,
            20415344333067211554313767647173316815633650301918575829180346199575148665069,
            13633607044021261454592301643776774471506136393197655091607153111809692259827,
            17626382501942124969670374792018350942605689405520546466395023785525103457772,
            6255130007440352475586779494540799345697151453620498404684287023866754032195,
            2306420438605431607312373948206860996365826880719671804403227899691442642275,
            4150363807050088396750775240898711262004668876090032828172183316703043617084,
            9285776438223884734095920133464178522986212162963113198329705711530022755474,
            8056245838608759554698484529642753348130450429952114586931207871322395041815,
            829446916649705348257442271383036596109831007865232372951010216352973856102,
            15625844823843742331377435271348898429806773907706957229487113022647409605361,
            17577215254230038681044296028571180213054589255605607934723836664200460717900,
            4124229832085578583077869950144104703940266264741956903327521199121573501608,
            956031698336452717497389079207622866195639459873143186082987758896484229,
            5487769121388770345615143731451204496184522941699064154293259736290756392281,
            19108950170023869461538962233070087426931251449826530140055386340274890769167,
            7163000216570455074777102916820126400342893785358062370686334644901802716505,
            14069640400657532520790066635439688750290832696214662389914232245184577987605,
            14479095476877873508593405236559685736944417409010219390373088620503838868785,
            11043376324951564630295063545881897023187225476665201691779119515533375480252,
            6661591922024143863903119681178399387179738898889488260140141217630949684386,
            17927082573887870255529415967544840794920526486962884358695763200806862985438,
            15344303696167473428185520131001557945151158928934418717607087940721131071771,
            17828901388887620356410917900625497901094760477352492091024073624237013942199,
            5769518280776219280348806914409031054861885958377061286627123087874468415022,
            20431638183966720923747678544392833631728898200788128041644136204565867666984,
            14090311824048372853539847278330124303544521408720141325283894959006662687091,
            15804084401916535956023972758931440413196961744226290253921088303207341241624,
            10175297222545750585200940163401746333807648231440289201216247047524751759800,
            13627178737833643325046087156870554446390418636209130074562504809322111869500,
            17764785156322745811616274957857893730003514581313927504027431525383649283065,
            19937543609644633874244045584071513319940084126291037841384808425504856959809,
            15342869912500112422884539229077598061058242489491935447109976878452037033019,
            4013492969397695899529067291377948657188133360500998015125042159905219451015,
            16103905218751069353094807042927849506925475562597187182212408854543207896959,
            2944966103404214689454479077610632002184309721317595891830348815514138974993,
            19325487880070548816481546080626501727703757521670156955545429121889907017078,
            15100611674249075800234419199981693339415458125591559941958899707860947271422,
            6218214894290298932830945017157709916726367407377109198377811798014269361190,
            3614165109447709133560376394488775114154990932214419240709263538964730044793,
            12470050172980003866604498941402078627176474309316996939154587962693108703299,
            14326289824673195766543135223924392856300692884210680409566943198387130534249,
            7165620177605763101832310619318620116564431262592759082667960394096717376500,
            18493771796714829301152103254042763361093649431709146313898656697172517003945,
            19378625792400725160148754441980615224328206358712449787191830385569052540718,
            16007402863448410912816003285924721663646270264336429632226480560624517786686,
            19237707356717010870867249970023585450752058166604784815899910412334118876206,
            9220901909365521359272987854473280604305514630161634933792728147200095467721,
            18410176193267269760889921269714281086974268347930205200427649918630849695090,
            12965918287638240770016302976315806827103490796349349929211883141517180287503,
            12349885027991520677991049785373756989469740692405700621974604138574619128352,
            15140677976927930153718380266136837953174676164754951887174512491543032379920,
            21827316269013449013188767671586670698408107313889499652064913346916661205134,
            10291812801925801309131054705443171387126537143097132025959359704437606934960,
            672629582827557307834340543416423795975619286037134883571663102667617424871,
            9083153504687841911409635752154916541456530320234522038682211776832174884204,
            161613037914350129447953455746594623670089874690447598296434941180521161285,
            1171831809755547667039573902133455330288960313227076960068862237693067984118,
            17976189993590514293111768052821991211636574345378720268206023944617980529106,
            13948370962030564908187265531622789477695009070053704775908221837286270607966,
            15111661739470387139733117722325456302153247510554411603536976158713756343685,
            3221531107111649093775586747571600894615551850056053161545522010276694129173,
            7525542917866422579566433035530637587726813500360210520814714634676104279988,
            8625720047687802748444032281466047855411176674826009376380238164048839653452,
            1056416492230936454964451703492915255828249793107492310087329043951628247251,
            11686963004766839650667919430569065145234172371899251505321297227463387997856,
            19446964304867464094499259761468367651915647234727431353353415788061585074215
        ];
        vk.IC = new Pairing.G1Point[](icLen);
        for (uint256 icCounter = 0; icCounter < icLen; ++icCounter) {
            vk.IC[icCounter] = Pairing.G1Point(MAGIC_NUMS[icCounter * 2], MAGIC_NUMS[icCounter * 2 + 1]);
        }
    }

    function verify(uint256[] memory input, Proof memory proof) internal view returns (uint256) {
        uint256 snark_scalar_field = 21888242871839275222246405745257275088548364400416034343698204186575808495617;
        VerifyingKey memory vk = verifyingKey();
        require(input.length + 1 == vk.IC.length, "verifier-bad-input");
        // Compute the linear combination vk_x
        Pairing.G1Point memory vk_x = Pairing.G1Point(0, 0);
        for (uint256 i = 0; i < input.length; i++) {
            require(input[i] < snark_scalar_field, "verifier-gte-snark-scalar-field");
            vk_x = Pairing.addition(vk_x, Pairing.scalar_mul(vk.IC[i + 1], input[i]));
        }
        vk_x = Pairing.addition(vk_x, vk.IC[0]);
        if (
            !Pairing.pairingProd4(
                Pairing.negate(proof.A), proof.B, vk.alfa1, vk.beta2, vk_x, vk.gamma2, proof.C, vk.delta2
            )
        ) return 1;
        return 0;
    }

    /// @return r  bool true if proof is valid
    function verifyProof(uint256[2] memory a, uint256[2][2] memory b, uint256[2] memory c, uint256[198] memory input)
        internal
        view
        returns (bool r)
    {
        Proof memory proof;
        proof.A = Pairing.G1Point(a[0], a[1]);
        proof.B = Pairing.G2Point([b[0][0], b[0][1]], [b[1][0], b[1][1]]);
        proof.C = Pairing.G1Point(c[0], c[1]);
        uint256[] memory inputValues = new uint256[](input.length);
        for (uint256 i = 0; i < input.length; i++) {
            inputValues[i] = input[i];
        }
        if (verify(inputValues, proof) == 0) {
            return true;
        } else {
            return false;
        }
    }
}
